<?php /** @var $block \Zoorate\PoinZilla\Block\Adminhtml\System\Config\RetryByDate */ ?>
<div class="admin__field-complex">
    <div class="admin__field">
        <label class="admin__field-label"><span>Dal</span></label>
        <div class="admin__field-control">
            <input id="pz-retry-from" class="admin__control-text"
                   data-mage-init='{"calendar":{"dateFormat":"yyyy-MM-dd"}}'
                   placeholder="YYYY-MM-DD" />
        </div>
    </div>
    <div class="admin__field">
        <label class="admin__field-label"><span>Al</span></label>
        <div class="admin__field-control">
            <input id="pz-retry-to" class="admin__control-text"
                   data-mage-init='{"calendar":{"dateFormat":"yyyy-MM-dd"}}'
                   placeholder="YYYY-MM-DD" />
        </div>
    </div>
    <div class="admin__field">
        <button id="pz-retry-run" class="action-default scalable save primary"><span>Forza retry</span></button>
    </div>
</div>

<script>
    require(['jquery','mage/translate'], function ($, $t) {
        $('#pz-retry-run').on('click', function (e) {
            e.preventDefault();
            const from = $('#pz-retry-from').val(), to = $('#pz-retry-to').val();
            if (!from || !to) return alert($t('Seleziona entrambe le date.'));
            $.ajax({
                url: '<?= $block->escapeUrl($block->getPostUrl()) ?>',
                type: 'POST', dataType: 'json', showLoader: true,
                data: { form_key: '<?= $block->escapeHtml($block->getFormKeyValue()) ?>', from, to }
            }).done(function (resp) {
                alert(resp && resp.message ? resp.message : $t('Operazione completata.')); location.reload();
            }).fail(function (xhr) {
                let msg = $t("Errore durante l'operazione.");
                if (xhr.responseJSON && xhr.responseJSON.message) msg = xhr.responseJSON.message;
                alert(msg);
            });
        });
    });
</script>
